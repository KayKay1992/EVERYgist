USER PROFILE & SETTINGS PAGE - IMPLEMENTATION GUIDE
===================================================

This document explains how the User Profile & Settings functionality was implemented in the EVERYgist blog platform.

## OVERVIEW
Implemented a complete user profile management system allowing users to:
- View and edit their profile information (name, bio, profile picture)
- Change their password securely
- View all their comments across blog posts
- Access profile from both blog and admin interfaces

## BACKEND IMPLEMENTATION

### 1. Database Model (models/User.js)
Already had the necessary fields:
- name: String (required)
- email: String (required, unique)
- password: String (required, hashed)
- profileImageUrl: String (default: null)
- bio: String (default: '')
- role: String (enum: 'member', 'admin')

### 2. Controllers (controllers/authController.js)
Added three new controller functions:

**a) updateUserProfile()**
- Route: PUT /api/auth/profile
- Access: Private (requires authentication)
- Updates: name, bio, profileImageUrl
- Returns: Updated user object without password
- Code:
  ```javascript
  const updateUserProfile = async (req, res) => {
    const { name, bio, profileImageUrl } = req.body;
    const user = await User.findById(req.user.id);
    
    if (name) user.name = name;
    if (bio !== undefined) user.bio = bio;
    if (profileImageUrl) user.profileImageUrl = profileImageUrl;
    
    await user.save();
    res.json(user data without password);
  }
  ```

**b) changePassword()**
- Route: PUT /api/auth/change-password
- Access: Private (requires authentication)
- Validates: Current password, new password (min 6 chars)
- Hashes: New password with bcrypt
- Returns: Success message
- Code:
  ```javascript
  const changePassword = async (req, res) => {
    const { currentPassword, newPassword } = req.body;
    
    // Verify current password
    const isMatch = await bcrypt.compare(currentPassword, user.password);
    if (!isMatch) return error;
    
    // Hash and save new password
    const salt = await bcrypt.genSalt(10);
    user.password = await bcrypt.hash(newPassword, salt);
    await user.save();
  }
  ```

**c) getUserComments()**
- Route: GET /api/auth/my-comments
- Access: Private (requires authentication)
- Returns: All comments by the authenticated user
- Populates: post (title, slug) and author (name, profileImageUrl)
- Sorted: By createdAt descending (newest first)
- Code:
  ```javascript
  const getUserComments = async (req, res) => {
    const comments = await Comment.find({ author: req.user.id })
      .populate("post", "title slug")
      .populate("author", "name profileImageUrl")
      .sort({ createdAt: -1 });
    res.json(comments);
  }
  ```

### 3. Routes (routes/authRoutes.js)
Added three new protected routes:
```javascript
router.put("/profile", protect, updateUserProfile);
router.put("/change-password", protect, changePassword);
router.get("/my-comments", protect, getUserComments);
```

All routes use the `protect` middleware which:
- Verifies JWT token from Authorization header
- Attaches user object to req.user
- Blocks unauthorized access

## FRONTEND IMPLEMENTATION

### 1. API Paths (utils/apiPaths.js)
Added new endpoints to AUTH object:
```javascript
AUTH: {
  UPDATE_PROFILE: `/api/auth/profile`,
  CHANGE_PASSWORD: `/api/auth/change-password`,
  MY_COMMENTS: `/api/auth/my-comments`,
}
```

### 2. Profile Page (pages/Blog/Profile.jsx)
Created comprehensive profile page with 3 tabs:

**Component Structure:**
- Uses BlogLayout wrapper
- Tabs component for navigation
- 3 main sections: Profile Info, Security, My Comments

**State Management:**
```javascript
const [activeTab, setActiveTab] = useState("profile");
const [profileData, setProfileData] = useState({
  name: "",
  bio: "",
  profileImageUrl: ""
});
const [passwordData, setPasswordData] = useState({
  currentPassword: "",
  newPassword: "",
  confirmPassword: ""
});
const [userComments, setUserComments] = useState([]);
```

**Tab 1: Profile Info**
- Profile photo upload:
  - File input with camera icon button
  - Image preview (shows current or uploaded image)
  - Remove image button (X icon)
  - Upload to /api/auth/upload-image endpoint
  - Validates: file type (images only), size (max 5MB)
  - Shows loading spinner during upload
- Name input field (required)
- Email field (disabled - cannot be changed)
- Bio textarea (optional)
- Save button submits to updateUserProfile()

**Tab 2: Security (Password Change)**
- Current password input
- New password input (min 6 characters)
- Confirm new password input
- Validation: Checks if new passwords match
- Info box: Shows password requirements
- Submit calls changePassword() API

**Tab 3: My Comments**
- Fetches user comments on tab load
- Shows loading spinner while fetching
- Empty state: Shows friendly message if no comments
- Comment cards display:
  - Post title (clickable link to post)
  - Comment content
  - Timestamp (formatted with moment.js)
  - "View Post" button
- Sorted by newest first

**Image Upload Implementation:**
```javascript
const handleImageUpload = async (e) => {
  const file = e.target.files[0];
  
  // Validate file type and size
  if (!file.type.startsWith("image/")) return error;
  if (file.size > 5 * 1024 * 1024) return error;
  
  // Upload to server
  const formData = new FormData();
  formData.append("image", file);
  
  const response = await axiosInstance.post(
    API_PATHS.IMAGE.UPLOAD_IMAGE,
    formData,
    { headers: { "Content-Type": "multipart/form-data" } }
  );
  
  // Update state with returned URL
  setProfileData({ ...profileData, profileImageUrl: response.data.imageUrl });
};
```

**Profile Update Handler:**
```javascript
const handleProfileUpdate = async (e) => {
  e.preventDefault();
  const response = await axiosInstance.put(
    API_PATHS.AUTH.UPDATE_PROFILE,
    profileData
  );
  
  // Update user context so changes reflect immediately
  setUser({ ...user, ...response.data });
  toast.success("Profile updated successfully!");
};
```

**Password Change Handler:**
```javascript
const handlePasswordChange = async (e) => {
  e.preventDefault();
  
  // Validate passwords match
  if (passwordData.newPassword !== passwordData.confirmPassword) {
    toast.error("New passwords do not match");
    return;
  }
  
  await axiosInstance.put(API_PATHS.AUTH.CHANGE_PASSWORD, {
    currentPassword: passwordData.currentPassword,
    newPassword: passwordData.newPassword,
  });
  
  // Clear form on success
  setPasswordData({ currentPassword: "", newPassword: "", confirmPassword: "" });
  toast.success("Password changed successfully!");
};
```

### 3. Routing (App.jsx)
Added profile route accessible to all authenticated users:
```javascript
import Profile from "./pages/Blog/Profile";

<Route path="/profile" element={<Profile />} />
```

### 4. Navigation Updates

**a) ProfileInfoCard Component (components/Cards/ProfileInfoCard.jsx)**
Enhanced to show dropdown menu:
- Shows user avatar (image or initial badge)
- Displays user name
- Chevron icon for dropdown
- Dropdown menu contains:
  - User info header (name, email)
  - "My Profile" button → navigates to /profile
  - "Logout" button → clears local storage and redirects
- Click-outside-to-close functionality
- Smooth animations and transitions

**b) Blog Navbar (components/layouts/BlogLayout/BlogNavbar.jsx)**
- Shows ProfileInfoCard for logged-in users
- Desktop: Profile dropdown in navbar
- Mobile: Profile link in side menu

**c) Admin Navbar (components/layouts/Navbar.jsx)**
- Added ProfileInfoCard import and usage
- Shows profile dropdown for admin users
- Same functionality as blog navbar

**d) Side Menu (components/layouts/SideMenu.jsx)**
- Added conditional rendering for profile link
- Only shows "My Profile" if user is logged in
- Fixed width to w-64 (256px) instead of w-full
- Made scrollable with overflow-y-scroll
- Profile menu hidden for non-authenticated users

**e) Navigation Data (utils/data.js)**
- Added to BLOG_NAVBAR_DATA:
  ```javascript
  {
    id: "profile",
    label: "My Profile",
    icon: LuUser,
    path: "/profile",
    onlySideMenu: true  // Only shows in mobile menu
  }
  ```
- Added to SIDE_MENU_DATA (admin):
  ```javascript
  {
    id: "profile",
    label: "My Profile",
    icon: LuUser,
    path: "/profile"
  }
  ```

### 5. Tabs Component (components/Tabs.jsx)
Updated to be more flexible:
- Accepts both `setActiveTab` and `onTabChange` props
- Works with `tab.id` or `tab.label`
- Renders icons if provided
- Border-bottom design instead of gradient boxes
- Supports optional count badges
- Code:
  ```javascript
  const handleTabClick = (tabId) => {
    if (setActiveTab) setActiveTab(tabId);
    else if (onTabChange) onTabChange(tabId);
  };
  
  const isActive = activeTab === tab.id || activeTab === tab.label;
  ```

## SECURITY FEATURES

1. **Authentication Required**
   - All profile endpoints protected by JWT middleware
   - Unauthorized users redirected to home page
   - Profile page checks for user on mount

2. **Password Security**
   - Current password verification before change
   - Minimum 6 character requirement
   - Passwords hashed with bcrypt (salt rounds: 10)
   - Password never sent in responses

3. **Input Validation**
   - Backend validates required fields
   - Frontend validates image type and size
   - Password match validation on frontend
   - Email cannot be changed (prevents account hijacking)

4. **Authorization**
   - Users can only view/edit their own profile
   - Users can only see their own comments
   - req.user.id from JWT ensures data isolation

## USER EXPERIENCE FEATURES

1. **Toast Notifications**
   - Success messages for updates
   - Error messages for failures
   - Clear feedback for all actions

2. **Loading States**
   - Spinner during image upload
   - Disabled buttons during submission
   - Loading indicator for comments fetch

3. **Responsive Design**
   - Mobile-friendly layout
   - Dropdown works on all screen sizes
   - Side menu for mobile navigation

4. **Form Validation**
   - Required field indicators
   - Real-time validation feedback
   - Clear error messages

5. **Visual Design**
   - Purple/pink gradient theme
   - Smooth animations and transitions
   - Hover effects on buttons
   - Clean, modern UI with Tailwind CSS

## FILE STRUCTURE

Backend:
├── models/User.js (already existed)
├── controllers/authController.js (+3 functions)
├── routes/authRoutes.js (+3 routes)
└── middleware/authMiddleware.js (already existed)

Frontend:
├── pages/Blog/Profile.jsx (NEW)
├── components/
│   ├── Cards/ProfileInfoCard.jsx (UPDATED)
│   ├── Tabs.jsx (UPDATED)
│   └── layouts/
│       ├── SideMenu.jsx (UPDATED)
│       ├── Navbar.jsx (UPDATED)
│       └── BlogLayout/BlogNavbar.jsx (already had ProfileInfoCard)
├── utils/
│   ├── apiPaths.js (UPDATED)
│   └── data.js (UPDATED)
└── App.jsx (UPDATED - added route)

## TESTING CHECKLIST

✅ Profile page loads for authenticated users
✅ Non-authenticated users redirected from /profile
✅ Profile info updates successfully
✅ Profile photo upload works (5MB limit, image validation)
✅ Password change works with validation
✅ Current password verification works
✅ Password mismatch shows error
✅ User comments load and display correctly
✅ Comment links navigate to correct posts
✅ Profile dropdown opens/closes properly
✅ Click outside closes dropdown
✅ Profile link shows in both blog and admin menus
✅ Profile link hidden for non-logged-in users
✅ Toast notifications display correctly
✅ Form validation works on all inputs
✅ Loading states show during async operations
✅ User context updates after profile edit
✅ Email field is disabled (non-editable)
✅ Empty states show when no comments exist

## API ENDPOINTS SUMMARY

POST   /api/auth/register          - Register new user
POST   /api/auth/login             - Login user
GET    /api/auth/profile           - Get user profile (protected)
PUT    /api/auth/profile           - Update user profile (NEW, protected)
PUT    /api/auth/change-password   - Change password (NEW, protected)
GET    /api/auth/my-comments       - Get user's comments (NEW, protected)
POST   /api/auth/upload-image      - Upload profile image

## FUTURE ENHANCEMENTS

Possible improvements:
- Email verification before allowing email change
- Two-factor authentication
- Profile visibility settings (public/private)
- User activity statistics
- Social media links in profile
- Profile badges/achievements
- Export user data feature
- Delete account functionality
- Password strength indicator
- Profile completion percentage

## CONCLUSION

The User Profile & Settings feature is now fully functional with:
- Secure backend API with proper authentication
- Clean, responsive frontend with 3-tab interface
- Profile editing, password change, and comment history
- Accessible from both blog and admin interfaces
- Proper validation, error handling, and user feedback
- Modern UI matching the existing design system

All features tested and working without errors.
