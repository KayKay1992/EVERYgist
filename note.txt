Creating Authentication APIs (Register, Login and user Profile)

run this command to generate jwt token and use it in your .env file.  node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

i used Insomnia to test the apis.

===============================================================================
Authentication APIs — Changed Files Explanation
Generated: November 01, 2025
===============================================================================

Files changed:
- backend/controllers/authController.js
- backend/routes/authRoutes.js
- backend/middleware/authMiddleware.js
- backend/middleware/uploadMiddleware.js
- backend/server.js
- backend/.env

Summary
-------
You implemented registration, login and profile endpoints plus an image upload endpoint. The changes add authentication flows (JWT issuance and verification), file upload handling via multer, route registration in the server, and environment variables for JWT and admin access.

Detailed per-file explanation
-----------------------------

1) backend/controllers/authController.js
----------------------------------------
- registerUser(req, res):
	* Validates required fields (name, email, password).
	* Checks for an existing user with the same email and returns 400 if so.
	* Hashes the password using bcrypt (salt rounds = 10).
	* Determines role = 'admin' when `adminAccessToken` matches `process.env.ADMIN_ACCESS_TOKEN`, otherwise 'member'.
	* Creates a new User document and returns 201 with user info and a JWT token.

- loginUser(req, res):
	* Finds the user by email and verifies the password using bcrypt.compare.
	* Returns user info and a JWT token on success.
	* Returns a 500 status in current code for invalid credentials — consider changing to 401/400 for clarity.

- getUserProfile(req, res):
	* Protected action; looks up the user by ID (attached by middleware) and returns the user without the password.

Notes & Recommendations:
- Use consistent and proper status codes: 401 for unauthorized, 400 for bad request, 201 for created.
- Consider making `password` `select: false` in the User model and adding an instance method to compare passwords.
- Add input validation (email format, password strength) and sanitize fields.


2) backend/routes/authRoutes.js
--------------------------------
- Registers the following routes on an Express router:
	* POST /register → registerUser
	* POST /login → loginUser
	* GET /profile → protect middleware → getUserProfile
	* POST /upload-image → upload.single('image') → returns imageUrl

Notes:
- The upload endpoint uses the `upload` middleware that stores files into `uploads/` and returns a fully qualified URL.


3) backend/middleware/authMiddleware.js
---------------------------------------
- protect middleware:
	* Reads the Authorization header expecting "Bearer <token>".
	* Verifies token with `process.env.JWT_SECRET` and decodes the user ID.
	* Loads the user from DB (without password) and attaches it to `req.user`.
	* Returns 401 on missing/invalid/expired token.

Notes:
- Good standard JWT flow. Consider caching user lookups if performance becomes an issue.


4) backend/middleware/uploadMiddleware.js
-----------------------------------------
- Configures multer with diskStorage to save uploads to `uploads/`.
- Filenames are prefixed with a timestamp to avoid collisions.
- File filter restricts to common image types (jpeg, png, gif).

Notes:
- Consider size limits and a separate upload folder per environment.
- In production, consider object storage (S3, Cloud Storage) instead of disk.


5) backend/server.js
--------------------
- Loads `.env`, connects to MongoDB (via `connectDB()`), configures CORS (open origin currently), and mounts routes at `/api/auth`.
- Serves `uploads/` statically.
- Starts the server on `process.env.PORT || 8000`.

Notes:
- Ensure CORS is tightened for production.
- Consider adding centralized error handling and request logging (morgan).


6) backend/.env
----------------
- New env variables added/used:
	* MONGO_URI — Atlas connection string (encoded password)
	* JWT_SECRET — 128-hex char string used to sign JWTs
	* PORT — server listening port
	* ADMIN_ACCESS_TOKEN — simple token to allow admin role assignment during registration

Security note: Keep `.env` out of source control (already in .gitignore). For production, use a secrets manager.


Verification & Manual Testing
-----------------------------
- You reported testing via Insomnia and the server logs show MongoDB connection success.
- To test endpoints manually:
	* Register: POST /api/auth/register (body: name, email, password)
	* Login: POST /api/auth/login (body: email, password)
	* Profile: GET /api/auth/profile with header `Authorization: Bearer <token>` returned from login/register
	* Upload image: POST /api/auth/upload-image (form-data with key `image`)


Next steps (suggestions)
-----------------------
- Replace 500 responses for invalid creds with 401 Unauthorized.
- Hide password field in the User schema and add a comparePassword method.
- Add input validation and sanitization.
- Add tests and a Postman/Insomnia collection for automated testing.
- Move uploads to object storage for production.

===============================================================================
Change summary added above. Let me know if you want me to apply small refactors (status code fixes, password select: false, or add comparePassword) automatically.
===============================================================================